<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Вход в систему</title>
    <link rel="stylesheet" href="styles.css">
    <style>
        /* Дополнительные стили для формы входа */
        .login-links {
            display: flex;
            justify-content: space-between;
            margin: 15px 0;
            font-size: 0.9em;
        }

        .login-links a {
            color: #fff;
            text-decoration: none;
            transition: all 0.3s ease;
            padding: 5px 10px;
            border-radius: 4px;
            background: rgba(255, 255, 255, 0.1);
        }

        .login-links a:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
        }

        .divider {
            display: flex;
            align-items: center;
            margin: 20px 0;
            color: rgba(255, 255, 255, 0.7);
        }

        .divider::before,
        .divider::after {
            content: "";
            flex: 1;
            border-bottom: 1px solid rgba(255, 255, 255, 0.3);
            margin: 0 10px;
        }
    </style>
    <script>
        function handleLogin() {
    const email = document.getElementById('email').value;
    const password = document.getElementById('password').value;

    fetch('login.php', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/x-www-form-urlencoded',
        },
        body: `email=${encodeURIComponent(email)}&password=${encodeURIComponent(password)}`
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            showFireworks(data.message, data.redirect);
        } else {
            alert(data.message);
        }
    })
    .catch(error => {
        console.error('Error:', error);
        alert('Ошибка соединения с сервером');
    });
}
        function validateLogin() {
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            const button = document.getElementById('login-button');

            // Email validation
            const emailPattern = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            const isEmailValid = emailPattern.test(email);

            // Enable button only when all fields are valid
            button.disabled = !(isEmailValid && password.length >= 6);
        }

        function handleLogin() {
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;

            fetch('login.php', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                },
                body: `email=${encodeURIComponent(email)}&password=${encodeURIComponent(password)}`
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    showFireworks(data.message, data.redirect);
                } else {
                    alert(data.message);
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('Ошибка соединения с сервером');
            });
        }

        window.onload = function() {
            const inputs = document.querySelectorAll('#login-form input');
            inputs.forEach(input => {
                input.addEventListener('input', validateLogin);
            });
            validateLogin(); // Initial button state
            showUserCount(); // Show user count
        }

        function showUserCount() {
            fetch('get_user_count.php')
                .then(response => response.json())
                .then(data => {
                    const userCountDiv = document.getElementById('user-count');
                    userCountDiv.textContent = data.count + ' пользователей в системе';
                    userCountDiv.style.display = 'block';
                })
                .catch(() => {
                    const userCountDiv = document.getElementById('user-count');
                    userCountDiv.textContent = 'Добро пожаловать!';
                    userCountDiv.style.display = 'block';
                });
        }
    </script>
</head>
<body>
    <div class="header">
        <nav>
            <ul>
                <li><a href="index.html">Главная</a></li>
                <li><a href="recipes.html">Рецепты</a></li>
                <li><a href="forum.html">Форум</a></li>
                <li><a href="login.html" class="active">Войти</a></li>
            </ul>
        </nav>
    </div>
    <div class="snow"></div>
    <div class="content">
        <div class="form">
            <section id="login-form">
                <h2>Вход в аккаунт</h2>

                <div id="user-count" style="text-align: center; margin-bottom: 20px; font-style: italic;"></div>

                <label for="email">Электронная почта:</label>
                <input type="email" id="email" name="email" required placeholder="Ваш email">

                <label for="password">Пароль:</label>
                <input type="password" id="password" name="password" required placeholder="Не менее 6 символов" minlength="6">

                <div class="login-links">
                    <a href="register.html">Создать аккаунт</a>
                </div>

                <button class="recipe-btn" id="login-button" onclick="handleLogin()" disabled>Войти</button>

                <canvas id="fireworksCanvas" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none;"></canvas>
            </section>
        </div>
    </div>
    <div class="snowdrift"></div>
    <div class="snowdrift1" style="left: 0%; width: 100%; height: 90px;"></div>
    <audio autoplay loop>
        <source src="new-year.mp3" type="audio/mpeg">
        Ваш браузер не поддерживает аудио.
    </audio>
    <script src="script.js"></script>
</body>
</html>